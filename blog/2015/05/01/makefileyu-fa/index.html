
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Makefile语法 - Qindamoni</title>
  <meta name="author" content="Qindamoni">

  
  <meta name="description" content="基本结构 1
2
3
target ... : prerequisites ... command ... 1
target ... : prerequisites ... ; command ... target 要生成的目标，可以是下面任意一个，或下面组成的列表 具体的文件目标，如：main. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://qindamoni.com/blog/2015/05/01/makefileyu-fa">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Qindamoni" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!-- qindamoni script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script-->
  <script src="/javascripts/libs/jquery.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--qindamoni link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->
<!--qindamoni link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Qindamoni</a></h1>
  
    <h2>&nbsp;</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:qindamoni.com" />
    <input class="search" type="text" name="q" results="0"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Makefile语法</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-01T20:05:54+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>8:05 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>基本结构</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">target</span> <span class="p">...</span> <span class="o">:</span> <span class="n">prerequisites</span> <span class="p">...</span>
</span><span class='line'>    <span class="n">command</span>
</span><span class='line'>    <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">target</span> <span class="p">...</span> <span class="o">:</span> <span class="n">prerequisites</span> <span class="p">...</span> <span class="p">;</span> <span class="n">command</span> <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>target

<ul>
<li>要生成的目标，可以是下面任意一个，或下面组成的列表

<ul>
<li>具体的文件目标，如：main.o</li>
<li>最终的应用程序，如：app.exe</li>
<li>动态库，静态库。</li>
<li>伪目标，如：clean，install</li>
</ul>
</li>
</ul>
</li>
<li>prerequisites

<ul>
<li>生成target需要的依赖规则，可以是单个或者多个规则，可以是下面的任意一个，或列表

<ul>
<li>具体的文件，如：main.c，main.h</li>
<li>objectFile，如：main.o</li>
<li>动态库，静态库</li>
<li>伪目标，如：cleanone，cleantwo</li>
</ul>
</li>
</ul>
</li>
<li>command

<ul>
<li>生成target所执行的具体的命令。需要以tab开头。也可以与target同行，使用<code>;</code>号隔开。</li>
<li>command 是可执行的shell命令</li>
<li>只有当prerequisites中有一个以上文件的修改时间早于target的修改时间才会执行command指令。</li>
</ul>
</li>
</ul>


<!-- more -->


<p>例如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">app</span><span class="p">.</span><span class="nl">exe</span> <span class="p">:</span> <span class="n">main</span><span class="p">.</span><span class="n">o</span> <span class="n">child</span><span class="p">.</span><span class="n">o</span>
</span><span class='line'>    <span class="n">cc</span> <span class="o">-</span><span class="n">o</span> <span class="n">app</span><span class="p">.</span><span class="n">exe</span> <span class="n">main</span><span class="p">.</span><span class="n">o</span> <span class="n">child</span><span class="p">.</span><span class="n">o</span>
</span><span class='line'><span class="n">main</span><span class="p">.</span><span class="nl">o</span> <span class="p">:</span> <span class="n">main</span><span class="p">.</span><span class="n">h</span> <span class="n">main</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'>    <span class="n">cc</span> <span class="o">-</span><span class="n">c</span> <span class="n">main</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'><span class="n">child</span><span class="p">.</span><span class="nl">o</span> <span class="p">:</span> <span class="n">child</span><span class="p">.</span><span class="n">h</span> <span class="n">child</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'>    <span class="n">cc</span> <span class="o">-</span><span class="n">c</span> <span class="n">child</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'>
</span><span class='line'><span class="nl">clean</span> <span class="p">:</span>
</span><span class='line'>    <span class="n">rm</span> <span class="o">*</span><span class="p">.</span><span class="n">o</span>
</span></code></pre></td></tr></table></div></figure>


<h3>执行流程</h3>

<ul>
<li>make 在当前目录下寻找<code>Makefile</code>或者<code>makefile</code>文件</li>
<li>从<code>Makefile</code>文件找到第一个target，即app.exe，作为默认target，也是最终生成的文件。</li>
<li>如果app.exe不存在，或者所依赖的main.o，child.o文件比app.exe新，那么就执行后面的command命令，重新生成app.exe。</li>
<li>如果main.o文件不存在，或者main.c，main.h修改时间早于main.o那么执行后面的command命令，重新生成main.o文件</li>
<li>main.c，main.h是我们的源文件，理论上是一定存在的。</li>
</ul>


<h4>Makefile如上所示，一步一步的解决依赖，最终生成目标文件。如main.h文件被修改，那么将重新生成main.o。而新的main.o文件又导致app.exe重新生成。</h4>

<h3>自动推导</h3>

<ul>
<li>Makefile中看到<code>.o</code>结尾的target时候，make会自动将.c文件添加到prerequisites依赖里面，并且也会自动推导出<code>cc -c xxx.c</code>命令</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">main</span><span class="p">.</span><span class="nl">o</span> <span class="p">:</span> <span class="n">main</span><span class="p">.</span><span class="n">c</span> <span class="n">main</span><span class="p">.</span><span class="n">h</span>
</span><span class='line'>    <span class="n">cc</span> <span class="o">-</span><span class="n">c</span> <span class="n">main</span><span class="p">.</span><span class="n">c</span>
</span></code></pre></td></tr></table></div></figure>


<p>等价于</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">main</span><span class="p">.</span><span class="nl">o</span> <span class="p">:</span> <span class="n">main</span><span class="p">.</span><span class="n">h</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>而且当多个.o目标都依赖于某一个.h文件时候可以合并编写</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">main</span><span class="p">.</span><span class="nl">o</span> <span class="p">:</span> <span class="n">defs</span><span class="p">.</span><span class="n">h</span>
</span><span class='line'><span class="n">child</span><span class="p">.</span><span class="nl">o</span> <span class="p">:</span> <span class="n">defs</span><span class="p">.</span><span class="n">h</span>
</span></code></pre></td></tr></table></div></figure>


<p>等价于</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">main</span><span class="p">.</span><span class="n">o</span> <span class="n">child</span><span class="p">.</span><span class="nl">o</span> <span class="p">:</span> <span class="n">defs</span><span class="p">.</span><span class="n">h</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>当定义一个目标，且prerequisites为空时，make会自动推导出该目标是伪目标，并不是生成文件</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">clean</span><span class="p">:</span>
</span><span class='line'>    <span class="n">rm</span> <span class="o">*</span><span class="p">.</span><span class="n">o</span>
</span></code></pre></td></tr></table></div></figure>


<p>自动推导伪目标有隐患（当真的存在一个clean文件），所以最好使用<code>.PHONY</code>显示的定义伪目标</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">.</span><span class="nl">PHONY</span> <span class="p">:</span> <span class="n">clean</span>
</span><span class='line'><span class="nl">clean</span> <span class="p">:</span>
</span><span class='line'>    <span class="n">rm</span> <span class="o">*</span><span class="p">.</span><span class="n">o</span>
</span></code></pre></td></tr></table></div></figure>


<h3>变量</h3>

<h4>定义变量</h4>

<ul>
<li><code>value = val</code>

<ul>
<li>使用变量没有先后顺序</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">value1</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span>
</span><span class='line'><span class="n">value2</span> <span class="o">=</span> <span class="mi">123</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 或者</span>
</span><span class='line'>
</span><span class='line'><span class="n">value2</span> <span class="o">=</span> <span class="mi">123</span>
</span><span class='line'><span class="n">value1</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">value1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>value := val</code>

<ul>
<li>变量使用之前必须定义</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="c1">// 正确</span>
</span><span class='line'><span class="n">value2</span> <span class="o">=</span> <span class="mi">123</span>
</span><span class='line'><span class="nl">value1</span> <span class="p">:</span><span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 错误</span>
</span><span class='line'><span class="nl">value1</span> <span class="p">:</span><span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span>
</span><span class='line'><span class="n">value2</span> <span class="o">=</span> <span class="mi">123</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>value ?= val</code>

<ul>
<li>如果变量value没有定义，那么赋值val</li>
</ul>
</li>
<li><code>value += val</code>

<ul>
<li>对变量value追加val</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">value</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">c</span> <span class="n">b</span><span class="p">.</span><span class="n">c</span> <span class="n">c</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'><span class="nl">value</span> <span class="p">:</span><span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="n">d</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 等价于</span>
</span><span class='line'>
</span><span class='line'><span class="nl">value</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">c</span> <span class="n">b</span><span class="p">.</span><span class="n">c</span> <span class="n">c</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'><span class="n">value</span> <span class="o">+=</span> <span class="n">d</span><span class="p">.</span><span class="n">c</span>
</span></code></pre></td></tr></table></div></figure>


<h4>使用变量</h4>

<ul>
<li><code>$value</code>

<ul>
<li>不推荐</li>
</ul>
</li>
<li><code>$(value)</code>

<ul>
<li>推荐</li>
</ul>
</li>
<li><code>${value}</code>

<ul>
<li>推荐</li>
</ul>
</li>
</ul>


<h4>变量替换</h4>

<ul>
<li><code>$(val:a=b)</code></li>
<li>等价于</li>
<li><code>${val:a=b}</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">value1</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">c</span> <span class="n">b</span><span class="p">.</span><span class="n">c</span> <span class="n">c</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'><span class="nl">value2</span> <span class="p">:</span><span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="nl">value1</span><span class="p">:.</span><span class="n">c</span> <span class="o">=</span> <span class="p">.</span><span class="n">o</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $(value2) = a.o b.o c.o</span>
</span></code></pre></td></tr></table></div></figure>


<p>等价于</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">value1</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">c</span> <span class="n">b</span><span class="p">.</span><span class="n">c</span> <span class="n">c</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'><span class="nl">value2</span> <span class="p">:</span><span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="nl">value1</span><span class="p">:</span><span class="o">%</span><span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="o">%</span><span class="p">.</span><span class="n">o</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $(value2) = a.o b.o c.o</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
</span><span class='line'><span class="n">y</span> <span class="o">=</span> <span class="n">z</span>
</span><span class='line'><span class="nl">a</span> <span class="p">:</span><span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $(a) = z</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
</span><span class='line'><span class="n">y</span> <span class="o">=</span> <span class="n">z</span>
</span><span class='line'><span class="n">z</span> <span class="o">=</span> <span class="n">u</span>
</span><span class='line'><span class="nl">a</span> <span class="p">:</span><span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $(a) = u</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">first_second</span> <span class="o">=</span> <span class="n">Hello</span>
</span><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="n">first</span>
</span><span class='line'><span class="n">b</span> <span class="o">=</span> <span class="n">second</span>
</span><span class='line'><span class="n">all</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">$</span><span class="n">a_</span><span class="err">$</span><span class="n">b</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $(all) = Hello</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">ifdef</span> <span class="n">do_sort</span>
</span><span class='line'><span class="nl">func</span> <span class="p">:</span><span class="o">=</span> <span class="n">sort</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="nl">func</span> <span class="p">:</span><span class="o">=</span> <span class="n">strip</span>
</span><span class='line'><span class="n">endif</span>
</span><span class='line'>
</span><span class='line'><span class="nl">bar</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span> <span class="n">d</span> <span class="n">b</span> <span class="n">g</span> <span class="n">q</span> <span class="n">c</span>
</span><span class='line'>
</span><span class='line'><span class="nl">foo</span> <span class="p">:</span><span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="err">$</span><span class="p">(</span><span class="n">bar</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $(foo) = $(sort a d b g q c) 或者 $(strip a d b g q c)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>重写命令行变量</h4>

<ul>
<li><code>override value = val</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="c1">// makefile</span>
</span><span class='line'><span class="n">value</span> <span class="o">=</span> <span class="n">abc</span>
</span><span class='line'><span class="nl">all</span><span class="p">:</span>
</span><span class='line'>    <span class="n">echo</span> <span class="err">$</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 输出abc</span>
</span><span class='line'><span class="err">$</span><span class="o">&gt;</span> <span class="n">make</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 输出123</span>
</span><span class='line'><span class="err">$</span><span class="o">&gt;</span> <span class="n">make</span> <span class="n">value</span><span class="o">=</span><span class="mi">123</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// makefile</span>
</span><span class='line'><span class="n">override</span> <span class="n">value</span><span class="o">=</span><span class="n">abc</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 输出abc</span>
</span><span class='line'><span class="err">$</span><span class="o">&gt;</span> <span class="n">make</span> <span class="n">value</span><span class="o">=</span><span class="mi">123</span>
</span></code></pre></td></tr></table></div></figure>


<h4>多行变量</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">defile</span> <span class="n">value</span>
</span><span class='line'><span class="n">abc</span>
</span><span class='line'><span class="mi">123</span>
</span><span class='line'><span class="n">endef</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $(value) = abc ; 123</span>
</span></code></pre></td></tr></table></div></figure>


<h4>环境变量</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span><span class="o">&gt;</span><span class="n">make</span> <span class="n">value</span><span class="o">=</span><span class="mi">123</span>
</span></code></pre></td></tr></table></div></figure>


<p>makefile中定义环境变量</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">export</span> <span class="n">value</span><span class="o">=</span><span class="mi">123</span>
</span></code></pre></td></tr></table></div></figure>


<h4>目标变量</h4>

<ul>
<li>理论上在makefile中定义的变量都是全局变量</li>
<li>单独给某个target定义的变量为目标变量</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;</span><span class="n">target</span><span class="o">&gt;</span> <span class="o">:</span> <span class="o">&lt;</span><span class="n">target</span><span class="o">-</span><span class="n">assignment</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 或者</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">target</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">override</span> <span class="o">&lt;</span><span class="n">target</span><span class="o">-</span><span class="n">assignment</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><target-assigenmet>与全局变量的定义相同</li>
<li>目标变量的值会覆盖全局变量的值</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">all</span> <span class="p">:</span> <span class="n">value1</span><span class="o">=</span><span class="n">val1</span> <span class="n">value2</span><span class="o">?=</span><span class="n">val2</span> <span class="n">value3</span><span class="o">+=</span><span class="n">val3</span> <span class="nl">value4</span><span class="p">:</span><span class="o">=</span><span class="n">val4</span>
</span><span class='line'>
</span><span class='line'><span class="nl">all</span> <span class="p">:</span>
</span><span class='line'>    <span class="n">echo</span> <span class="err">$</span><span class="p">(</span><span class="n">value1</span><span class="p">)</span>  <span class="c1">// val1</span>
</span><span class='line'>    <span class="n">echo</span> <span class="err">$</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span>  <span class="c1">// val2</span>
</span><span class='line'>    <span class="n">echo</span> <span class="err">$</span><span class="p">(</span><span class="n">value3</span><span class="p">)</span>  <span class="c1">// val3</span>
</span><span class='line'>    <span class="n">echo</span> <span class="err">$</span><span class="p">(</span><span class="n">value4</span><span class="p">)</span>  <span class="c1">// val4</span>
</span></code></pre></td></tr></table></div></figure>


<h4>内置多命令变量</h4>

<ul>
<li>$@ 表示多命令中被选中的那一个</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="nl">d</span> <span class="p">:</span>
</span><span class='line'>    <span class="n">echo</span> <span class="err">$@</span>
</span></code></pre></td></tr></table></div></figure>


<h3>条件判断</h3>

<ul>
<li>相等判断</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
</span><span class='line'><span class="n">ifeq</span> <span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="n">val</span><span class="p">)</span>
</span><span class='line'>    <span class="n">value2</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>    <span class="n">value2</span> <span class="o">=</span> <span class="n">val</span>
</span><span class='line'><span class="n">endif</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>不相等判断</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
</span><span class='line'><span class="n">ifneq</span> <span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="n">val</span><span class="p">)</span>
</span><span class='line'>    <span class="n">value2</span> <span class="o">=</span> <span class="n">val</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>    <span class="n">value2</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'><span class="n">endif</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>定义判断</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">ifdef</span> <span class="n">value</span>
</span><span class='line'>    <span class="n">value2</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>    <span class="n">value2</span> <span class="o">=</span> <span class="n">val</span>
</span><span class='line'><span class="n">endif</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>未定义判断</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">ifndef</span> <span class="n">value</span>
</span><span class='line'>    <span class="n">value2</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>    <span class="n">value2</span> <span class="o">=</span> <span class="n">val</span>
</span><span class='line'><span class="n">endif</span>
</span></code></pre></td></tr></table></div></figure>


<h3>几个全局变量</h3>

<ul>
<li><code>$(MAKE)</code>

<ul>
<li>make执行文件路径</li>
</ul>
</li>
<li><code>$(MAKELEVEL)</code>

<ul>
<li>makefile的嵌套层次</li>
</ul>
</li>
</ul>


<h3>屏蔽</h3>

<ul>
<li>命令之前添加<code>-</code>号，表示忽略错误，继续执行</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">all</span><span class="p">:</span>
</span><span class='line'>    <span class="o">-</span><span class="n">rm</span> <span class="o">*</span><span class="p">.</span><span class="n">o</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>命令之前添加<code>@</code>号，表示不打印该命令</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="c1">// 输出123</span>
</span><span class='line'><span class="nl">all</span><span class="p">:</span>
</span><span class='line'>    <span class="err">@</span><span class="n">echo</span> <span class="mi">123</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 输出 echo 123</span>
</span><span class='line'><span class="c1">// 123</span>
</span><span class='line'><span class="nl">all</span><span class="p">:</span>
</span><span class='line'>    <span class="n">echo</span> <span class="mi">123</span>
</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Qindamoni</span></span>

      




<time class='entry-date' datetime='2015-05-01T20:05:54+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>8:05 pm</span></time>
      


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/04/14/opengl-ji-chu-zhi-shi/" title="Previous Post: OpenGL 基础知识">&laquo; OpenGL 基础知识</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/01/makefileyu-fa/">Makefile语法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/14/opengl-ji-chu-zhi-shi/">OpenGL 基础知识</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/02/c-plus-plus-bei-wang/">C++备忘</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/01/cocos2dyuan-ma-fen-xi/">Cocos2d源码分析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/31/shellyu-fa-zong-jie/">Shell语法总结</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/13/vimji-qiao-zong-jie/">Vim技巧总结</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/20/js-api-lie-biao/">Js Api 列表</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/20/shen-ru-li-jie-jsshu-ju-lei-xing/">深入理解js数据类型</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/17/markdown-yu-fa/">Markdown 语法</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Qindamoni -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
